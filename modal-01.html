<div class="modal-header">
	<h1 class="modal-title" id="modalLabel">설비정보</h1>
	<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body p-0">
	<div class="modal-facility">
		<button type="button" class="btn btn-primary toggle-button" id="toggle-side" data-bs-toggle="tooltip" data-bs-placement="top" title="트리메뉴 열기">
			<span class="material-symbols-outlined">
			menu_open
			</span>
		</button>
		<div class="side-panel left" id="side-panel">

			<!-- 검색영역 -->
			<label for="search-input" class="form-label visually-hidden">설비명 입력</label>
			<input class="form-control" list="datalistOptions" id="search-input" placeholder="설비명 입력">
			<datalist id="datalistOptions">
				<option value="Turbine 1">
				<option value="Steam Turbine 5">
				<option value="Gas Turbine 2">
				<option value="HRSG 1">
				<option value="ACC">
			</datalist>
			
			<!-- 트리메뉴 -->
			<div id="jstree" class="jstree-box border bg-white rounded d-flex"></div>
		</div>
		<div class="contents-panel" id="contents-panel">
			
			<div id="content-display">
				
				<!-- 제목영역 -->
				<div class="d-flex justify-content-between align-items-center">
					<h2 class="box-title01">좌측 패널에서 설비명을 검색해 주세요.</h2>
					<button type="button" class="btn btn-primary" onclick="showAlert();">
						<span class="material-symbols-outlined me-2">
						view_in_ar
						</span> 이동
					</button>
				</div>
				
				<!-- 데이터 테이블 -->
				<div id="grid-table">
					<!-- tab-menu -->
					<ul class="nav nav-tabs" id="facTab" role="tablist">
						<li class="nav-item" role="presentation">
							<button class="nav-link active" id="tab01" data-bs-toggle="tab" data-bs-target="#tab01-pane" type="button"
								role="tab" aria-controls="tab01-pane" aria-selected="true">설비</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="tab02" data-bs-toggle="tab" data-bs-target="#tab02-pane" type="button"
								role="tab" aria-controls="tab02-pane" aria-selected="false">정비이력</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="tab03" data-bs-toggle="tab" data-bs-target="#tab03-pane" type="button"
								role="tab" aria-controls="tab03-pane" aria-selected="false">고장이력</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="tab04" data-bs-toggle="tab" data-bs-target="#tab04-pane" type="button"
								role="tab" aria-controls="tab04-pane" aria-selected="false">자재</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="tab03" data-bs-toggle="tab" data-bs-target="#tab05-pane" type="button"
								role="tab" aria-controls="tab05-pane" aria-selected="false">TM 발행</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="tab03" data-bs-toggle="tab" data-bs-target="#tab06-pane" type="button"
								role="tab" aria-controls="tab06-pane" aria-selected="false">운전정보</button>
						</li>
						<!-- 
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="disabled-tab" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane"
								type="button" role="tab" aria-controls="disabled-tab-pane" aria-selected="false" disabled>Disabled</button>
						</li>
						 -->
					</ul>

					<!-- tab content -->
					<div class="tab-content" id="facTabContent">
						<div class="tab-pane fade show active" id="tab01-pane" role="tabpanel" aria-labelledby="tab01" tabindex="0">
							<!-- data table -->
							<h3 class="box-title02">설비정보<small>(전체 10건)</small></h3>

							<!-- fac list -->
							<div class="table-wrapper">
								<div class="table-header"></div>
								<div class="table-body">
									<table class="table has-data-id" id="mainTable">
										<thead class="table-light">
											<tr>
												<th scope="col" class="text-center">설비번호</th>
												<th scope="col" class="text-left">설비명</th>
												<th scope="col" class="text-center">기능위치번호</th>
												<th scope="col" class="text-center">계통코드</th>
												<th scope="col" class="text-center">종류코드</th>
												<th scope="col" class="text-center">상태</th>
											</tr>
										</thead>
										<tbody>
											<tr data-id="01">
												<th class="text-center">12340001</th>
												<td class="text-left">CWP Screen Wash PP-A</td>
												<td class="text-center">54321-12345</td>
												<td class="text-center">01285</td>
												<td class="text-center">BVF02</td>
												<td class="text-center">운전</td>
											</tr>
											<tr data-id="02">
												<th class="text-center">12340001</th>
												<td class="text-left">CWP Screen Wash PP-A</td>
												<td class="text-center">54321-12345</td>
												<td class="text-center">01285</td>
												<td class="text-center">BVF02</td>
												<td class="text-center">운전</td>
											</tr>
											<tr>
												<th class="text-center">12340001</th>
												<td class="text-left">CWP Screen Wash PP-A</td>
												<td class="text-center">54321-12345</td>
												<td class="text-center">01285</td>
												<td class="text-center">BVF02</td>
												<td class="text-center">운전</td>
											</tr>
											<tr>
												<th class="text-center">12340001</th>
												<td class="text-left">CWP Screen Wash PP-A</td>
												<td class="text-center">54321-12345</td>
												<td class="text-center">01285</td>
												<td class="text-center">BVF02</td>
												<td class="text-center">운전</td>
											</tr>
											<tr>
												<th class="text-center">12340001</th>
												<td class="text-left">CWP Screen Wash PP-A</td>
												<td class="text-center">54321-12345</td>
												<td class="text-center">01285</td>
												<td class="text-center">BVF02</td>
												<td class="text-center">운전</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>

							<h4 class="box-title03">CWP Screen Wash PP-A 상세정보</h4>
							<!-- info -->
							<div class="data-table detail-table" id="detailTable01">
								<table class="table">
									<colgroup>
										<col style="width: 160px;">
										<col>
										<col style="width: 160px;">
										<col>
										<col style="width: 160px;">
										<col style="width: 120px;">
									</colgroup>
									<tbody>
										<tr>
											<th scope="row">설비번호</th>
											<td>70340001</td>
											<th scope="row">설비명</th>
											<td>CWP Screen Wash PP-A</td>
											<th scope="row">상태</th>
											<td>운전</td>
										</tr>
										<tr>
											<th scope="row">기능위치번호</th>
											<td>38733-12345</td>
											<th scope="row">기능위치명</th>
											<td colspan="3">CWP Screen Wash Pump</td>
										</tr>
										<tr>
											<th scope="row">계통코드</th>
											<td>01285</td>
											<th scope="row">계통명</th>
											<td colspan="3">스크린세척펌프(Screen Wash Pump)</td>
										</tr>
										<tr>
											<th scope="row">종류코드</th>
											<td>BVF02</td>
											<th scope="row">종류명</th>
											<td colspan="3">BFP & Centrifugal Pump</td>
										</tr>
										<tr>
											<th scope="row">자산번호</th>
											<td>4001012567</td>
											<th scope="row">자산명</th>
											<td colspan="3">CWP 스크린 세척용 펌프 자재</td>
										</tr>
										<tr>
											<th scope="row">계층구조</th>
											<td colspan="5">평택복합2단계 > #1 증기터빈설비 > 순환수 설비 > Intake Screen & Wash SYS > CWP Screen Wash Pump > CWP Screen Wash PP-A</td>
										</tr>
									</tbody>
								</table>
							</div>
							
							<div class="data-table detail-table" id="detailTable02">
								<table class="table">
									<colgroup>
										<col style="width: 160px;">
										<col>
										<col style="width: 160px;">
										<col>
										<col style="width: 160px;">
										<col style="width: 120px;">
									</colgroup>
									<tbody>
										<tr>
											<th scope="row">설비번호</th>
											<td>12340040</td>
											<th scope="row">설비명</th>
											<td>CWP Backwash Filter PP-A</td>
											<th scope="row">상태</th>
											<td>운전</td>
										</tr>
										<tr>
											<th scope="row">기능위치번호</th>
											<td>38733-12345</td>
											<th scope="row">기능위치명</th>
											<td colspan="3">CWP Screen Wash Pump</td>
										</tr>
										<tr>
											<th scope="row">계통코드</th>
											<td>01285</td>
											<th scope="row">계통명</th>
											<td colspan="3">스크린세척펌프(Screen Wash Pump)</td>
										</tr>
										<tr>
											<th scope="row">종류코드</th>
											<td>TYU0</td>
											<th scope="row">종류명</th>
											<td colspan="3">CWP Backwash Filter PP-A</td>
										</tr>
										<tr>
											<th scope="row">자산번호</th>
											<td>4001012567</td>
											<th scope="row">자산명</th>
											<td colspan="3">CWP 스크린 세척용 펌프 자재</td>
										</tr>
										<tr>
											<th scope="row">계층구조</th>
											<td colspan="5">평택복합2단계 > #1 증기터빈설비 > 순환수 설비 > CWP Backwash Filter PP-A > CWP Screen Wash PP-A</td>
										</tr>
									</tbody>
								</table>
							</div>

							<script>
								$(document).ready(function() {
									$('#mainTable tbody tr').click(function() {
										const id = $(this).data('id');
						
										// 모든 상세 테이블 숨기기
										$('.detail-table').hide();
						
										// 클릭한 ID에 해당하는 상세 테이블 보여주기
										$(`#detailTable${id}`).show();
									});
								});
							</script>
						</div>
						<div class="tab-pane fade" id="tab02-pane" role="tabpanel" aria-labelledby="tab02" tabindex="0">
							<p>준비중입니다.</p>
						</div>
						<div class="tab-pane fade" id="tab03-pane" role="tabpanel" aria-labelledby="tab03" tabindex="0">
							<p>준비중입니다.</p>
						</div>
						<div class="tab-pane fade" id="tab04-pane" role="tabpanel" aria-labelledby="tab04" tabindex="0">
							<p>준비중입니다.</p>
						</div>
						<div class="tab-pane fade" id="tab05-pane" role="tabpanel" aria-labelledby="tab04" tabindex="0">
							<p>준비중입니다.</p>
						</div>
						<div class="tab-pane fade" id="tab05-pane" role="tabpanel" aria-labelledby="tab05" tabindex="0">
							<p>준비중입니다.</p>
						</div>
						<div class="tab-pane fade" id="tab06-pane" role="tabpanel" aria-labelledby="tab06" tabindex="0">
							<p>준비중입니다.</p>
						</div>
						<!-- 
						<div class="tab-pane fade" id="disabled-tab-pane" role="tabpanel" aria-labelledby="disabled-tab" tabindex="0">
							<p>준비중입니다.</p>
						</div> -->
					</div>

				</div>

			</div>
		</div>
	</div>

</div>
<!-- 
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
<button type="button" class="btn btn-primary">Save changes</button>
</div>
-->

<script>
	$(document).ready(function () {

		$('.modal.facility').addClass('folded');
		
		// jsTree 초기화 함수
		initializeJSTree();

		let isCollapsed = true; // 초기 상태를 '닫힘'으로 설정
		$('.modal.facility').find('#toggle-side').css('transform', 'scaleX(-1)');

		function openSidePanel() {
			// 열림
			$('.modal.facility').removeClass('modal-move folded');
			$('.modal.facility').addClass('unfolded');
			$('#toggle-side').attr('title', '패널 닫기');
			$('#toggle-side').find('.material-symbols-outlined').css('transform', 'scaleX(-1)');
			isCollapsed = false; // 상태 업데이트
		}

		function closeSidePanel() {
			// 닫힘
			$('.modal.facility').addClass('modal-move folded');
			$('.modal.facility').removeClass('unfolded');
			$('#toggle-side').attr('title', '패널 열기');
			$('#toggle-side').find('.material-symbols-outlined').css('transform', 'scaleX(1)');
			isCollapsed = true; // 상태 업데이트
		}

		// 토글 기능: 현재 상태에 따라 패널 열기 또는 닫기
		function toggleSidePanel() {
			if (isCollapsed) {
				openSidePanel();
			} else {
				closeSidePanel();
			}
		}

		// 클릭 이벤트에 함수 바인딩
		if ($('.modal.facility').length > 0) {
			$('#toggle-side').on('click', toggleSidePanel);
		}

		// 3.3.15 버전
		function initializeJSTree() {
			// jsTree 데이터 정의
			const treeData = [
				{ "id": "node1", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node1'>visibility</span> <span class='fac-name'>SSWP-B</span></div>" },
				{ "id": "node2", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node2'>visibility</span> <span class='fac-name'>CTCS-A BALL RECIRCULATION PUMP</span></div>" },
				{ "id": "node3", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node3'>visibility</span> <span class='fac-name'>#1 GT LOWS</span></div>" },
				{ "id": "node4", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node4'>visibility</span> <span class='fac-name'>CCW HE-B</span></div>" },
				{ "id": "node5", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node5'>visibility</span> <span class='fac-name'>SLP Travelling Screen-B</span></div>" },
				{ "id": "node6", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node6'>visibility</span> <span class='fac-name'>CCW PP-B</span></div>" },
				{ "id": "node7", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node7'>visibility</span> <span class='fac-name'>SLP-A MTR</span></div>" },
				{ "id": "node8", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node8'>visibility</span> <span class='fac-name'>CWP-A MTR CLG WTR Line FT-001</span></div>" },
				{ "id": "node9", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node9'>visibility</span> <span class='fac-name'>CCP DISCH Seal WTR Line Safety Valve</span></div>" },
				{ "id": "node10", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node10'>visibility</span> <span class='fac-name'>CTCS Line</span></div>" },
				{ "id": "node11", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node11'>visibility</span> <span class='fac-name'>Sampling PP-C</span></div>" },
				{ "id": "node12", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node12'>visibility</span> <span class='fac-name'>RECIRCULATION CTCS-A BALL</span></div>" },
				{ "id": "node13", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node13'>visibility</span> <span class='fac-name'>SLP Travelling</span></div>" },
				{ "id": "node14", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node14'>visibility</span> <span class='fac-name'>CCW HE-B</span></div>" },
				{ "id": "node15", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node15'>visibility</span> <span class='fac-name'>WTR Line FT-001</span></div>" },
				{ "id": "node16", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node16'>visibility</span> <span class='fac-name'>SSWP-BOPSWP-B</span></div>" },
				{ "id": "node17", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node17'>visibility</span> <span class='fac-name'>CTCS-A BALL RECIRCULATION PUMP</span></div>" },
				{ "id": "node18", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node18'>visibility</span> <span class='fac-name'>DISCH Seal WTR Line Safety Valve</span></div>" },
				{ "id": "node19", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node19'>visibility</span> <span class='fac-name'>CWP-A MTR CLG WTR Line FT-001</span></div>" },
				{ "id": "node20", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node20'>visibility</span> <span class='fac-name'>Sampling PP-C</span></div>" },
				{ "id": "node21", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node21'>visibility</span> <span class='fac-name'>CCW HE-B</span></div>" },
				{ "id": "node22", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node22'>visibility</span> <span class='fac-name'>MTR CLG WTR Line</span></div>" },
				{ "id": "node23", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node23'>visibility</span> <span class='fac-name'>CCP DISCH Seal WTR Line Safety Valve</span></div>" },
				{ "id": "node24", "parent": "#", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node24'>visibility</span> <span class='fac-name'>BALL RECIRCULATION</span></div>" },

				// 중첩 노드
				{ "id": "node1-1", "parent": "node1", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node1-1'>visibility</span> <span class='fac-name'>MTR CLG WTR Line</span></div>" },
				{ "id": "node1-1-1", "parent": "node1-1", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node1-1-1'>visibility</span> <span class='fac-name'>DISCH Seal WTR Line Safety Valve</span></div>" },
				{ "id": "node1-1-1-1", "parent": "node1-1-1", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node1-1-1-1'>visibility</span> <span class='fac-name'>CTCS-A BALL RECIRCULATION PUMP</span></div>" },

				// More nested nodes
				{ "id": "node1-1-1-1-1", "parent": "node1-1-1-1", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node1-1-1-1-1'>visibility</span> <span class='fac-name'>CWP-A MTR CLG WTR Line FT-9005</span></div>" },
				{ "id": "node1-1-1-1-2", "parent": "node1-1-1-1", "text": "<div class='menu-item'><span class='material-symbols-outlined eye-icon' data-node='node1-1-1-1-2'>visibility</span> <span class='fac-name'>CWP-B MTR CLG WTR Line FT-9006</span></div>" },
			];

			// jsTree 초기화
			$('#jstree').jstree({
				'core': {
					'data': treeData
				},
				'state': {
					'key': 'jstree'
				},
				'types': {
					'default': {
						'icon': false // 아이콘 숨기기
					},
					'folder': {
						'icon': false // 폴더 아이콘 숨기기
					}
				},
				'plugins': ["types", "search"]
			});	

			// 노드 텍스트 클릭 이벤트 (우측 패널 업데이트)
			$('#jstree').on("select_node.jstree", function (e, data) {
				var fullNodeText = data.node.text;

				var tempElement = $('<div>').html(fullNodeText);

				// 'fac-name' 클래스를 가진 <span> 요소를 찾아 그 텍스트 가져오기
				var partialText = tempElement.find('span.fac-name').text();

				// partialText가 비어있는 경우 처리
				if (!partialText) {
					partialText = "좌측 패널에서 설비명을 검색해 주세요."; // Fallback if no matching element is found
				}

				$('#content-display h2.box-title01').text(partialText);
				
				// 메뉴 클릭 시 패널 항상 열기
				openSidePanel();
			});

			// 눈 아이콘 클릭 이벤트
			$('#jstree').on("click", ".eye-icon", function (e) {
				e.stopPropagation(); // 클릭 이벤트가 부모 노드로 전파되지 않도록 방지

				const $icon = $(this);
				const nodeId = $icon.data('node');

				// 아이콘 상태 토글
				if ($icon.text() === 'visibility') {
					$icon.text('visibility_off'); // 눈 감기 아이콘
					console.log(`아이콘 비활성화: ${nodeId}`);
				} else {
					$icon.text('visibility'); // 눈 뜨기 아이콘
					console.log(`아이콘 활성화: ${nodeId}`);
				}
			});

			// **검색 기능**
			$('#search-input').on('keyup', function() {
				var searchString = $(this).val();
				$('#jstree').jstree('search', searchString);
			});
		}


	});

</script>


